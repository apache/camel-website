# DocSearch Configuration

This directory contains the Algolia DocSearch configuration for the Apache Camel website.

## Overview

The `.docsearch.config.json` file defines how Algolia's crawler indexes the Camel website for search functionality. This configuration ensures that all relevant content is discoverable through the site search, including:

- All component documentation (not just canonical versions)
- Tables with component specifications and supported models
- Metadata sections and inline code
- Multiple documentation versions (next, latest, and release branches)

## Key Configuration Elements

### Index Settings (`index`)
- **name**: `apache_camel` - The Algolia index where content is stored
- **startUrls**: Entry points for the crawler
- **pathsToMatch**: URL patterns to include in indexing
- **pathsToIgnore**: URLs to skip (search pages, error pages, etc.)
- **includeHeadingLevels**: All heading levels (h1-h6) are indexed for better navigation

### Content Selectors (`selectors`)

These CSS selectors define what content gets indexed:

- **lvl0-lvl5**: Heading hierarchy (h1-h6) used to build the breadcrumb structure
- **text**: Main content to index including:
  - Paragraphs (`p`), list items (`li`)
  - Table cells (`td`, `th`) - **Important for component specs**
  - Definition terms (`dt`, `dd`)
  - Code blocks (`code`, `pre`)

This ensures keywords like "PyTorch" in Model Zoo tables are indexed, fixing issue #1209.

### Exclusions (`selectors_exclude`)

Navigation, sidebars, footers, and other non-content elements are excluded to improve search quality:
- `.no_index`, `[data-no-index]` - Custom exclusion attributes
- Navigation elements: `nav`, `.navbar`, `.menu`, `.sidebar`, `.toc`
- Footer and copyright
- Hidden elements: `.hidden`, `[aria-hidden='true']`

### Crawling Rules (`crawler`)

- **maxDepth**: 20 - Allows deep navigation through component docs
- **maxUrls**: 50,000 - Sufficient for Camel's comprehensive documentation
- **sitemapUrls**: Uses sitemap for efficient crawling
- **timeoutMs**: 30,000 - Adequate for large pages with tables

### Multi-Version Support (`start_urls`)

The configuration crawls multiple documentation versions:

1. **next** (page_rank: 5) - Development version
2. **latest** (page_rank: 5) - Latest stable
3. **\d+\.\d+\.\x** (page_rank: 4) - Release branches (4.4.x, 4.10.x, etc.)
4. **manual** (page_rank: 7) - Core documentation (highest priority)
5. **docs** (page_rank: 6) - General documentation
6. **blog** (page_rank: 3) - Blog posts

This addresses the issue where only canonical (4.4.x) pages were indexed.

### Search Behavior (`custom_settings`)

- **searchableAttributes**: Fields available for full-text search
- **separatorsToIndex**: Include underscores, dots, and dashes in search (important for component names like `camel-k`)
- **attributeForDistinctResults**: Deduplicate results by URL to avoid showing the same page multiple times

## Maintenance

When making changes to this configuration:

1. **Test locally** - Build the site and verify crawling works
2. **Document changes** - Explain why selectors or URLs were modified
3. **Consider impacts** - Changes affect search indexing across all users
4. **Verify coverage** - Use Algolia dashboard to check what's indexed

### Common Modifications

**Adding new documentation sections:**
```json
{
  "url": "https://camel.apache.org/new-section/",
  "page_rank": 5
}
```

**Excluding problematic content:**
```json
"selectors_exclude": [
  ".no_index",
  ".problematic-element"
]
```

**Adjusting content extraction:**
Modify the `text` selector in the `selectors` section to include additional elements.

## Related Issue

- **Issue #1209**: "The search is not finding several fields"
  - Problem: Keywords like Bradley, firmata, PyTorch not indexed from component documentation
  - Root cause: Missing configuration for table content and non-canonical versions
  - Solution: This configuration file with improved selectors and multi-version crawling

## References

- [Algolia DocSearch Documentation](https://docsearch.algolia.com/)
- [Camel Website GitHub](https://github.com/apache/camel-website)
- [Issue #1209](https://github.com/apache/camel-website/issues/1209)
